<%= link_to muscle_parts_path do %>
筋肉へ
<% end %>
<p>ようこそ
<%= link_to edit_user_path(@user) do %>
<% if @user.name == nil %>
<%= @user.email %>
<% else %>
<%= @user.name %>
<% end %>
<% end %>
さん</p>

<h4>現在のステータス</h4>
<% @body_composition_now.each do |body_composition| %>
<%= pie_chart ({ "除脂肪体重": body_composition.lean_body_weight, "脂肪": body_composition.body_fat_weight }) %>
体重　<%= body_composition.body_weight %>Kg
体脂肪率 <%= body_composition.body_fat_percentage %>%
<% if current_user.stature == nil %>
身長を記入してffmiを計算しよう
<% else %>
ffmi=<%= body_composition.ffmi_status %>
 <%= image_tag 'ffmi.png', class:"img-fluid", :alt => '全身筋肉画像の読み込みに失敗しました。' %>
<% end %>
<% end %>
<% @training_records.each do |training_record| %>
     <%= training_record.created_at.to_s(:datetime_jp) %>
     <%= training_record.training_event %>
     <%= training_record.training_note %><br>
     <% end %>

<%= form_with model: @body_composition, url: homes_path do |f| %>
<h4>体重を記録する</h4>
  <%= f.text_field :body_weight, :placeholder => "例 => 67.8" %>kg
  <%= f.text_field :body_fat_percentage, :placeholder => "例 => 12.3" %>%
  <%= f.hidden_field :user_id, :value => @user.id %>
  <%= f.hidden_field :date, :value => Date.current %>
<%= f.submit '保存' %>
<% end %>

<canvas id="myChart"></canvas>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
var ctx = document.getElementById('myChart');
var myChart = new Chart(ctx, {
    type: 'line',
    data: {
        labels: [<% @body_compositions.each do |body_composition| %>'<%= body_composition.date %>', <% end %>],
        datasets: [{
            label: '体脂肪',
            data: [<% @body_compositions.each do |body_composition| %><%= body_composition.body_weight %>, <% end %>],
            backgroundColor: ['rgba(255, 159, 64, 0.5)'
            ],
            borderColor: ['rgba(255, 159, 64, 0.5)'
            ],
      fill: 1,
            borderWidth: 2
    //     }, {
    //   fill: false,
    //   borderDash: [5, 5],
    //   data: [<% @body_compositions.each do |body_composition| %><%= body_composition.body_fat_weight %>, <% end %>],
    },{
      label: '除脂肪体重',
      data: [<% @body_compositions.each do |body_composition| %><%= body_composition.lean_body_weight %>, <% end %>],
      backgroundColor: ['rgba(255, 20, 20, 0.7)'
            ],
            borderColor: ['rgba(255, 60, 50, 0.7)'
            ],
      fill: true,
      hidden: false,
    }]
    },
    options:  {
        scales: {
            x: {
      grid:{
       display:false
           }
     },
            y: {
                title: {
          display: true,
          text: 'Kg'
                }
            }
        }
    }
});
</script>